function loteryDataUpdate(){var a=new FormData;a.append("action","loteryScript"),a.append("update_lotery_data",!0),$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:a,processData:!1,contentType:!1,success:function(a){if(!allowLoteryUpdate)return 0;$("#siteName .balance").text(number_format(a.user_balance,0,"."," ")+" К");var b=$("#layotWrapper #bizBlock #biz").children("ul");$(b).html(a.lotery_roulette),$("#bizBlock #bank #val").text(number_format(a.bank,0,"."," ")),$("#lastWinnerBlock").html(a.last_winner_block),$("#playersList").html(a.lotery_users_list),!timerInt&&a.restart_timer&&restartTimer(a.restart_timer);var c=$("#loteryWrapper #bizBlock #timer p");c.text()!=a.restart_timer&&timerInt&&c.text(a.restart_timer)}})}function restartTimer(a){$("#loteryWrapper #bizBlock #timer p").text(a),clearInterval(timerInt),timerInt=setInterval(loteryTimer,1e3),loteryTimer()}function loteryTimer(){var a=$("#loteryWrapper #bizBlock #timer p"),b=60*parseInt(a.text().split(":")[0])+parseInt(a.text().split(":")[1]);if(1==b&&(allowLoteryUpdate=!1,clearInterval(loteryUpdateInt)),"NaN"==a.text())clearInterval(timerInt),timerInt=!1,a.text("15:00");else if(0==b){allowLoteryUpdate=!1;var c=new FormData;c.append("action","loteryScript"),c.append("ajax_lotery_start",!0),$("#layotWrapper #bizBlock #biz #loading").css({display:"block"}),setTimeout(function(){$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:c,processData:!1,contentType:!1,success:function(a){loteryRoll(a)},error:function(a,b,c){message('Сервер не отвечает, лотерея будет разыграна в автономном режиме, победитель будет в блоке "Последний победитель"',1),setTimeout(function(){$("#layotWrapper #bizBlock #biz #loading").css({display:"none"})},500),allowLoteryUpdate=!0,loteryUpdateInt=setInterval(loteryDataUpdate,3e3),loteryDataUpdate()}})},1e3),clearInterval(timerInt),timerInt=!1,a.text("15:00")}else{b--;var d=parseInt(b/60,10);d<10&&(d="0"+d);var e=parseInt(b%60,10);e<10&&(e="0"+e),a.text(d+":"+e)}}function askForSpin(a){var b=new FormData;$(a).hasClass("deactivated")||($(".playButton").addClass("deactivated"),$("#layotWrapper #roulette #loading").css({display:"block"}),$(a).hasClass("test")&&(b.append("test_spin",!0),$(a).remove()),b.append("action","rouletteSpin"),$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:b,processData:!1,contentType:!1,success:function(b){rouletteRoll(a,b)},error:function(a,b,c){message("Не удаётся крутонуть рулетку, попробуйте позже",1),$(".playButton").removeClass("deactivated"),setTimeout(function(){$("#layotWrapper #roulette #loading").css({display:"none"})},500)}}))}function payment(a){void 0===a&&(a=!1);var b=$(a).attr("tab"),c=$(a).attr("href");if("add"==c||"withdraw"==c){var d=new FormData;d.append("action","payment"),d.append("method",c);for(var e=$(".balance_form_"+c+"_wrapper .balance_"+c+"_form .balance_inputs input[type=text]"),f=0;f<e.length;f++)d.append($(e[f]).attr("name"),$(e[f]).val().replace(/ /g,""));$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:d,processData:!1,contentType:!1,success:function(a){if(void 0!==a.message&&void 0!==a.message.err)return message(a.message.text,a.message.err),0;void 0!==a.message&&void 0!==a.message.text&&message(a.message.text,a.message.err),void 0!==a.redirectURL&&(window.location.href=a.redirectURL)},error:function(a,b,c){message("Ошибка, попробуйте позже",1)}})}else"add"!=b&&"withdraw"!=b||($(".balance_form_"+b+"_wrapper").css({display:"block"}),setTimeout(function(){$(".balance_form_wrapper .balance_"+b+"_form").css({opacity:"1"})},100))}function adminMessageSend(){event.preventDefault();var a=new FormData;a.append("message",$("#toAdministration .questionSend input[name=message]").val()),a.append("action","adminMessageSend"),$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:a,processData:!1,contentType:!1,success:function(a){message(a.message.text,a.message.err),$("#toAdministration .questionSend input[name=message]").val("")},error:function(){message("Не удаётся отправить сообщение, попробуйте позже",1)}})}function message(a,b){void 0!==b&&null!=b||(b=0),"block"!=$(".messageBox").css("display")&&($(".messageBox").css({display:"block"}),setTimeout(function(){$(".messageBox").css({visibility:"visible"}),$(".messageBox").css({opacity:"1"})},200),$(".messageBox").text(a),b&&$(".messageBox").addClass("negative"),setTimeout(function(){$(".messageBox").css({visibility:"hidden"}),$(".messageBox").css({opacity:"0"}),setTimeout(function(){$(".messageBox").css({display:"none"}),$(".messageBox").removeClass("negative"),$(".messageBox").text("")},200)},3e3))}function copyToBuffer(a){$($(a).parents(".copyBlock")).find('input[class="copyField"]').select(),document.execCommand("copy")}function number_format(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=void 0===d?",":d,h=void 0===c?".":c,i="",j=function(a,b){var c=Math.pow(10,b);return""+(Math.round(a*c)/c).toFixed(b)};return i=(f?j(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)}function getSiteStats(){var a=new FormData;a.append("action","updateData"),a.append("action_type","siteStats"),$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:a,processData:!1,contentType:!1,success:function(a){$("#siteStats #online p:nth-of-type(1)").text(number_format(a.usersOnline,0,"."," ")),$("#siteStats #online #case").text(a.usersOnlineCase),$("#siteStats #registered p:nth-of-type(1)").html("<span>"+number_format(a.usersTotalRegistered,0,"."," ")+"</span>"),$("#siteStats #registered #case").html(a.usersTotalRegisteredCase),$("#siteStats #creditsWon p:nth-of-type(1)").text(number_format(a.creditsTotalWon,0,"."," ")),$("#lastPlayers #players").html(a.rouletteLastWons)}})}var timerInt,loteryUpdateInt,allowLoteryUpdate=!0;$(function(){timerInt=setInterval(loteryTimer,1e3),loteryTimer(),"/lotery"==$("#headerWrapper ul li.checked a").attr("href")&&(loteryUpdateInt=setInterval(loteryDataUpdate,5e3)),setInterval(getSiteStats,5e3),getSiteStats()}),$("#loteryBlock #ticketBuy").submit(function(a){if(a.preventDefault(),$(this).hasClass("disabled"))return 0;$(this).addClass("disabled");var b=new FormData;b.append("action","loteryScript"),b.append("buy_ticket",!0),b.append("ticketCount",$(this).find('input[name="ticketCount"]').val()),$("#loteryBlock #ticketBuy #loading").css({display:"block"}),$.ajax({dataType:"json",type:"POST",url:"/ajax",cache:!1,data:b,processData:!1,contentType:!1,success:function(a){if($("#loteryBlock #ticketBuy #loading").css({display:"none"}),void 0!==a.message&&null!==a.message&&void 0!==a.message.err&&a.message.err)return $("#loteryBlock #ticketBuy").removeClass("disabled"),message(a.message.text,a.message.err),0;message("Билеты успешно приобретены!",0),loteryDataUpdate(),$("#loteryBlock #ticketBuy").removeClass("disabled")},error:function(a,b,c){$("#loteryBlock #ticketBuy #loading").css({display:"none"}),message("Сервер не отвечает, попробуйте позже",1),$("#loteryBlock #ticketBuy").removeClass("disabled")}})});var documentScroll={scrollKeyCodes:{37:1,38:1,39:1,40:1,32:1,33:1,34:1,35:1,36:1},preventDefault:function(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1},preventDefaultForScrollKeys:function(a){if(scrollKeyCodes[a.keyCode])return documentScroll.preventDefault(a),!1},disableScroll:function(){window.addEventListener&&window.addEventListener("DOMMouseScroll",documentScroll.preventDefault,!1),window.onwheel=documentScroll.preventDefault,window.onmousewheel=document.onmousewheel=documentScroll.preventDefault,window.ontouchmove=documentScroll.preventDefault,document.onkeydown=documentScroll.preventDefaultForScrollKeys},enableScroll:function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",documentScroll.preventDefault,!1),window.onwheel=null,window.onmousewheel=document.onmousewheel=null,window.ontouchmove=null,document.onkeydown=null}};